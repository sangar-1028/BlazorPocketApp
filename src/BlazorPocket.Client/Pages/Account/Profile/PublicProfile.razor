@using BlazorPocket.Client.Services
@using PocketBaseClient.BlazorPocket.Models
@using pocketbase_csharp_sdk.Models
<EditForm Model="@model" OnValidSubmit="OnValidSubmit">
    <div class="d-flex flex-row gap-3">
        <div class="d-flex flex-column gap-2">
            <MudText Typo="Typo.h4">Public profile</MudText>
            <MudTextField Label="Name" @bind-Value="model.Name" For="@(() => model.Name)" ShrinkLabel="true" Adornment="Adornment.End" IconSize="Size.Small" AdornmentIcon="@Icons.Material.Filled.Edit" HelperText="Your name may appear around application where you contribute or are mentioned. You can remove it at any time."></MudTextField>
            <MudTextField Label="User name" @bind-Value="model.Username" For="@(() => model.Username)" ShrinkLabel="true" Adornment="Adornment.End" IconSize="Size.Small" AdornmentIcon="@Icons.Material.Filled.Edit"></MudTextField>
            <MudTextField Label="Email" @bind-Value="model.Email" For="@(() => model.Email)" ShrinkLabel="true" ReadOnly Adornment="Adornment.End"></MudTextField>
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Save Profile</MudButton>
        </div>
        <div class="d-flex flex-column  gap-1 px-4">
            @if (!string.IsNullOrEmpty(model.Avatar))
            {
                <MudAvatar Style="width:150px;height:150px">
                    <MudImage Src="@model.Avatar" Width="150" Height="150" ObjectFit="ObjectFit.Cover" Alt="user name" Elevation="5" Class="rounded-lg"></MudImage>
                </MudAvatar>
            }
            else
            {
                <MudAvatar Style="width:150px;height:150px">@model.Username.FirstOrDefault()</MudAvatar>
            }
            <div class="flex-grow-0" style="margin-left:auto;margin-top:-35px;margin-right:20px">
                <MudIconButton Color="Color.Info" Icon="@Icons.Material.Filled.Camera" aria-label="Edit Avatar"></MudIconButton>
            </div>
        </div>


    </div>

</EditForm>

@code {
    private ProfileModel model = new();

    protected override async Task OnInitializedAsync()
    {
        var userModel = await PocketbaseClient.GetCurrentUserAsync();
        model = new ProfileModel { Email = userModel.Email?.Address, Name = userModel.Name, Username = userModel.Username, Avatar = userModel.Avatar.GetFileUrl() };
    }

    private void OnValidSubmit(EditContext context)
    {

        StateHasChanged();
    }

    public class ProfileModel
    {
        public string? Id { get; set; }
        public string? Username { get; set; }
        public string? Name { get; set; }
        public string? Email { get; set; }
        public string? Avatar { get; set; }
    }
}
